<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iPod Offline Music Player</title>
<style>
body {
  background:black; height:100vh; margin:0;
  display:flex; justify-content:center; align-items:center; color:white;
  font-family:sans-serif;
}
#ipod {
  width:330px; height:520px; background:#ddd;
  border-radius:30px; padding:20px;
  display:flex; flex-direction:column; justify-content:space-between;
  box-shadow:0 0 20px #000;
}
#screen {
  width:100%; height:200px; background:white; border-radius:10px;
  color:black; padding:15px; overflow:auto;
  font-size:15px;
}
#wheel {
  width:260px; height:260px; background:white; border-radius:50%;
  margin:auto; position:relative;
  display:flex; justify-content:center; align-items:center;
}
button {
  position:absolute; background:none; border:none; font-size:18px;
}
#menuBtn { top:15px; }
#nextBtn { right:15px; }
#prevBtn { left:15px; }
#playBtn { bottom:15px; }
#centerBtn {
  width:90px; height:90px; border-radius:50%; background:#eee;
}
#fileInput { display:none; }
</style>
</head>
<body>

<div id="ipod">
  <div id="screen">로딩 중...</div>

  <div id="wheel">
    <button id="menuBtn">MENU</button>
    <button id="nextBtn">▶▶</button>
    <button id="prevBtn">◀◀</button>
    <button id="playBtn">►/❚❚</button>
    <button id="centerBtn"></button>
  </div>
</div>

<!-- ★ 여러 파일 선택 가능 -->
<input type="file" id="fileInput" accept="audio/*" multiple>
<audio id="player"></audio>

<script>
// 저장된 음악 불러오기
let songs = JSON.parse(localStorage.getItem("songs") || "[]");
let index = 0;
let mode = "menu";

const screen = document.getElementById("screen");
const player = document.getElementById("player");
const fileInput = document.getElementById("fileInput");

function saveSongs() {
  localStorage.setItem("songs", JSON.stringify(songs));
}

// 메뉴 표시 + 선택 하이라이트
function showMenu() {
  mode = "menu";

  if (songs.length === 0) {
    screen.innerHTML = "<b>저장된 음악 없음</b><br><br>중앙 버튼 → 음악 추가(여러곡 가능)";
    return;
  }

  screen.innerHTML =
    "<b>저장된 음악</b><br><br>" +
    songs.map((s,i)=>
      `<span style="${i===index ?
        'background:#4da3ff;color:white;padding:2px 6px;border-radius:6px;' : ''}">${s.name}</span>`
    ).join("<br>") +
    "<br><br>삭제: MENU + 중앙 버튼";
}

function playSong() {
  if (!songs.length) return;
  mode = "playing";
  const song = songs[index];
  player.src = song.data;
  player.play();
  screen.innerHTML = `<b>재생중</b><br><br>${song.name}<br><br>${index+1}/${songs.length}`;
}

// 버튼 입력
document.getElementById("menuBtn").onclick = () => {
  if (mode==="playing") {
    showMenu();
  } else {
    if (songs.length > 0) {
      songs.splice(index,1);
      if (index >= songs.length) index = 0;
      saveSongs();
      showMenu();
    }
  }
};

document.getElementById("centerBtn").onclick = () => {
  if (mode==="menu") {
    if (songs.length === 0) {
      fileInput.click();
    } else {
      playSong();
    }
  } else {
    player.paused ? player.play() : player.pause();
  }
};

document.getElementById("nextBtn").onclick = () => {
  if(!songs.length) return;
  index = (index+1)%songs.length;
  mode==="playing" ? playSong() : showMenu();
};

document.getElementById("prevBtn").onclick = () => {
  if(!songs.length) return;
  index = (index-1+songs.length)%songs.length;
  mode==="playing" ? playSong() : showMenu();
};

document.getElementById("playBtn").onclick = () => {
  if(!songs.length)return;
  player.paused?player.play():player.pause();
};

// ★ 여러 곡 저장 기능!
fileInput.onchange = () => {
  const files = Array.from(fileInput.files);

  let remaining = files.length;

  files.forEach(file => {
    const reader = new FileReader();
    reader.onload = e => {
      songs.push({name:file.name,data:e.target.result});
      remaining--;
      if (remaining === 0) {
        saveSongs();
        showMenu();
      }
    };
    reader.readAsDataURL(file);
  });
};

// ★ 휠 이벤트로 선택 이동 추가!
window.addEventListener("wheel", e => {
  if (mode !== "menu") return;
  if (!songs.length) return;

  if (e.deltaY > 0) {
    index = (index + 1) % songs.length;
  } else {
    index = (index - 1 + songs.length) % songs.length;
  }
  showMenu();
});

// 시작 메뉴
showMenu();
</script>

</body>
</html>
